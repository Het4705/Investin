<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Investor</title>
</head>
<body>
    <h1>Update Investor</h1>
    <div>
        <label for="investorId">Investor ID:</label>
        <input type="text" id="investorId">
        <button type="button" onclick="fetchInvestorDetails()">Fetch Details</button>
    </div>
    <form id="investorForm" onsubmit="return updateInvestor(event)">
        <div>
            <label for="companyName">Company Name:</label>
            <input type="text" id="companyName" name="companyName" required>
        </div>
        <div>
            <label for="companyGovtVerifiedNo">Company Govt Verified No:</label>
            <input type="text" id="companyGovtVerifiedNo" name="companyGovtVerifiedNo" required>
        </div>
        <div>
            <label for="logo">Company Logo:</label>
            <input type="file" id="logo" name="logo">
        </div>
        <div id="keyPeopleContainer"></div>
        <div>
            <label for="briefInfo">Brief Info:</label>
            <input type="text" id="briefInfo" name="briefInfo" required>
        </div>
        <div id="companiesInvestedContainer"></div>
        <div>
            <label for="images">Images:</label>
            <input type="file" id="images" name="images" multiple>
        </div>
        <div>
            <label for="contact">Contact:</label>
            <input type="text" id="contact" name="contact" required>
        </div>
        <div>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
        </div>
        <div>
            <label for="addressCity">City:</label>
            <input type="text" id="addressCity" name="address[city]" required>
        </div>
        <div>
            <label for="addressState">State:</label>
            <input type="text" id="addressState" name="address[state]" required>
        </div>
        <div>
            <label for="addressCountry">Country:</label>
            <input type="text" id="addressCountry" name="address[country]" required>
        </div>
        <div>
            <label for="addressPincode">Pincode:</label>
            <input type="text" id="addressPincode" name="address[pincode]" required>
        </div>
        <div>
            <label for="likes">Likes:</label>
            <input type="number" id="likes" name="likes" required>
        </div>
        <button type="submit">Update Investor</button>
    </form>

    <script>
        async function fetchInvestorDetails() {
            const investorId = document.getElementById('investorId').value;
            try {
                const response = await fetch(`http://localhost:3000/api/investors/${investorId}`);
                if (!response.ok) throw new Error('Investor not found');
                const investor = await response.json();
                
                // Populate the form with the investor details
                document.getElementById('companyName').value = investor.companyName;
                document.getElementById('companyGovtVerifiedNo').value = investor.companyGovtVerifiedNo;
                document.getElementById('briefInfo').value = investor.briefInfo;
                document.getElementById('contact').value = investor.contact;
                document.getElementById('email').value = investor.email;
                document.getElementById('addressCity').value = investor.address.city;
                document.getElementById('addressState').value = investor.address.state;
                document.getElementById('addressCountry').value = investor.address.country;
                document.getElementById('addressPincode').value = investor.address.pincode;
                document.getElementById('likes').value = investor.likes;

                // Populate keyPeople
                const keyPeopleContainer = document.getElementById('keyPeopleContainer');
                keyPeopleContainer.innerHTML = '<h3>Key People</h3>';
                investor.keyPeople.forEach((person, index) => {
                    keyPeopleContainer.innerHTML += `
                        <div>
                            <label for="keyPersonName${index}">Name:</label>
                            <input type="text" id="keyPersonName${index}" name="keyPeople[${index}][name]" value="${person.name}" required>
                            <label for="keyPersonPosition${index}">Position:</label>
                            <input type="text" id="keyPersonPosition${index}" name="keyPeople[${index}][position]" value="${person.position}">
                            <label for="keyPersonInfo${index}">Info:</label>
                            <input type="text" id="keyPersonInfo${index}" name="keyPeople[${index}][info]" value="${person.info}">
                            <label for="keyPersonImage${index}">Image:</label>
                            <input type="file" id="keyPersonImage${index}" name="keyPeopleImages">
                        </div>
                    `;
                });

                // Populate companiesInvested
                const companiesInvestedContainer = document.getElementById('companiesInvestedContainer');
                companiesInvestedContainer.innerHTML = '<h3>Companies Invested</h3>';
                investor.companiesInvested.forEach((company, index) => {
                    companiesInvestedContainer.innerHTML += `
                        <div>
                            <label for="companyInvestedName${index}">Company Name:</label>
                            <input type="text" id="companyInvestedName${index}" name="companiesInvested[${index}][cname]" value="${company.cname}" required>
                            <label for="companyInvestedInfo${index}">Info:</label>
                            <input type="text" id="companyInvestedInfo${index}" name="companiesInvested[${index}][info]" value="${company.info}">
                            <label for="companyInvestedHoldingShare${index}">Holding Share:</label>
                            <input type="number" id="companyInvestedHoldingShare${index}" name="companiesInvested[${index}][holdingShare]" value="${company.holdingShare}">
                            <label for="companyInvestedLogo${index}">Company Logo:</label>
                            <input type="file" id="companyInvestedLogo${index}" name="Clogos">
                        </div>
                    `;
                });

            } catch (error) {
                alert('Error fetching investor details: ' + error.message);
            }
        }

        async function updateInvestor(event) {
            event.preventDefault();
            const investorId = document.getElementById('investorId').value;
            const formData = new FormData(document.getElementById('investorForm'));
            
            try {
                const response = await fetch(`http://localhost:3000/api/investors/${investorId}`, {
                    method: 'PUT',
                    body: formData
                });
                if (!response.ok) throw new Error('Failed to update investor');
                const result = await response.json();
                alert('Investor updated successfully');
            } catch (error) {
                alert('Error updating investor: ' + error.message);
            }
        }
    </script>
</body>
</html>
